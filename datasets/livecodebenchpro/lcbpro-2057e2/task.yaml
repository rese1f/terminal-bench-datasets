descriptions:
  - key: base
    description: |
      LiveCodeBench Pro (Mini) - external judge.

      The agent must create a C++17 solution file at /app/main.cpp.
      This task does not include local test cases. Instead, the test harness:
        1) POSTs the code to the external judge (/submit) to get a sid,
        2) polls GET /result/{sid}?short=1 until status == "done",
        3) passes only if the judge returns passed == true.

      Environment variables (overridable at runtime):
        - BASE_URL: judge base URL (default http://38.80.122.117:8081)
        - PID: problem id (default 2057E2)
        - LANG: language (default cpp)
        - CODE_PATH: path to code (default /app/main.cpp)
        - JUDGE_TIMEOUT_SECS: poll timeout seconds (default 120)
  - key: problem
    description: |
      This is the hard version of the problem. The difference between the versions is that in this version, there is no additional constraint on $m$. You can hack only if you solved all versions of this problem.

      Recently, the instructors of "T-generation" needed to create a training contest. They were missing one problem, and there was not a single problem on graphs in the contest, so they came up with the following problem.

      You are given a connected weighted undirected graph with $n$ vertices and $m$ edges, which does not contain self-loops or multiple edges.

      There are $q$ queries of the form $(a, b, k)$: among all paths from vertex $a$ to vertex $b$, find the smallest $k$-th maximum weight of edges on the path$^{\dagger}$.

      The instructors thought that the problem sounded very interesting, but there is one catch. They do not know how to solve it. Help them and solve the problem, as there are only a few hours left until the contest starts.

      $^{\dagger}$ Let $w_1 \ge w_2 \ge \ldots \ge w_{h}$ be the weights of all edges in a path, in non-increasing order. The $k$-th maximum weight of the edges on this path is $w_{k}$.

      ### Input

      Each test contains multiple test cases. The first line contains a single integer $t$ ($1 \le t \le 100$) -- the number of test cases. The description of the test cases follows.

      The first line of each set of test case contains three integers $n, m$ and $q$ ($2 \le n \le 400$, $n - 1 \le m \le \frac{n \cdot (n - 1)}{2}$, $1 \le q \le 3 \cdot 10^5$) -- the number of vertices, the number of edges, and the number of questions, respectively.

      Each of the following $m$ lines of each set of test case contains three integers $v, u$ and $w$ ($1 \le v, u \le n$, $1 \le w \le 10^9$) -- the ends of the next edge of the graph and its weight, respectively. It is guaranteed that the graph does not contain self-loops and multiple edges.

      Each of the following $q$ lines of each set of test case contains three integers $a, b$ and $k$ ($1 \le a, b \le n$, $k \ge 1$) -- the next question. It is guaranteed that any path from vertex $a$ to vertex $b$ contains at least $k$ edges.

      It is guaranteed that the sum of the values of $n$ across all sets of test cases does not exceed $400$.

      It is guaranteed that the sum of the values of $q$ across all sets of test cases does not exceed $3 \cdot 10^5$.

      ### Output

      For each set of test case, output the answers to all questions.

      ### Example

      #### Input #1

      ```

      3

      4 4 2

      1 2 2

      2 4 2

      1 3 4

      3 4 1

      1 4 2

      2 3 1

      6 7 3

      1 2 10

      2 3 3

      3 4 9

      4 5 2

      5 6 1

      2 4 10

      4 6 10

      1 6 3

      1 6 2

      2 4 1

      11 17 10

      1 4 5

      1 3 19

      1 2 10

      3 2 13

      4 5 1

      4 6 11

      3 5 9

      3 6 18

      2 7 17

      5 8 15

      5 10 8

      6 9 4

      7 10 20

      7 8 16

      8 11 3

      9 11 6

      10 11 14

      3 11 1

      3 11 3

      1 11 1

      1 11 4

      1 11 3

      8 2 2

      10 4 1

      3 9 2

      3 9 1

      6 7 3

      ```

      #### Output #1

      ```
      1 2
      2 9 9
      11 3 11 1 3 10 8 4 11 4
      ```

      ### Note

      In the first set of test cases, one of the optimal paths in the first query is the path $1 \rightarrow 3 \rightarrow 4$; the $2$-nd maximum weight of the edges on this path is $1$. In the second query, one of the optimal paths is $2 \rightarrow 4 \rightarrow 3$; $1$-st maximum weight of the edges is $2$.

      In the second set of input data, one of the optimal paths in the first query is the path $1 \rightarrow 2 \rightarrow 4 \rightarrow 5 \rightarrow 6$; the $3$-rd maximum weight of the edges on this path is $2$.

instruction: base
author_email: shz060@ucsd.edu
author: LiveCodeBench Pro Team
difficulty: medium
tags: []
max_agent_timeout_sec: 300
max_test_timeout_sec: 180